(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([[35957],{335972:(t,n,e)=>{e.d(n,{Z:()=>W});var a=e(667294),i=e(317672),r=e(790348);const s=t=>{const n=performance.getEntriesByType("resource").filter((t=>t.name.includes("i.pinimg"))).reduce(((t,n)=>{const e=n.name.replace(".jpg","").split("/");return{[e[e.length-1]]:{downloadSize:n.name.split("/")[3].split("x")[0]},...t}}),{});[...Array.from(document.getElementsByTagName("img")).map((t=>{const e=t.src.replace(".jpg","").split("/"),a=e[e.length-1];if(n[a]){var r;const e=(null===(r=(0,i.rZ)(t))||void 0===r?void 0:r.width)||1,s=n[a].downloadSize;return{fileName:a,renderedSize:e,downloadedSize:s,ratio:s/e}}return{fileName:a,renderedSize:1,downloadedSize:1,ratio:1}})),...Array.from(document.querySelectorAll('div[role="img"]')).map((t=>{const e=t.style.backgroundImage.split('"')[1].replace(".jpg","").split("/"),a=e[e.length-1];if(n[a]&&t instanceof HTMLDivElement){var r;const e=(null===(r=(0,i.rZ)(t))||void 0===r?void 0:r.width)||1,s=n[a].downloadSize;return{fileName:a,renderedSize:e,downloadedSize:s,ratio:s/e}}return{fileName:a,renderedSize:1,downloadedSize:1,ratio:1}}))].forEach((n=>{const{ratio:e,fileName:a,downloadedSize:i}=n;n.ratio>1.05&&(0,r.A9)(`checkImageRatio.${t}`,{count:Math.round(10*e)/10,tags:{fileName:`${i}_${a}`}})}))};var o=e(860273),c=e(543059),d=e(607150);const l=({constraintMap:t,initialNavTiming:n,annotations:e})=>({...e,...(0,d.jh)("constraint_",t),...(0,d.jh)("mark_",(0,c.gQ)()),...(0,d.jh)("browser_",{...n?(0,d.D3)(n):{},...(0,d.rX)()})});var m=e(358864),p=e(505771),u=e(156381);const g=(t,n)=>{const{firstInputDelay:e}=(0,u.v2)();return[...t.map((t=>(0,p.Z)(t,n))).filter(Boolean),...e?[{name:"fid",id:(0,m.Z)(),parentId:n,startTime:e.startTime,endTime:e.endTime,annotationMap:{},binaryAnnotationMap:{}}]:[]]};var T=e(22773),y=e(453821),f=e(638089);const _=({annotateExperiments:t,annotations:n,binaryAnnotations:e,constraintMap:a,endTime:i,imageTimings:r,metricId:s,pwtStaticContext:c,startTime:d,traceId:m,spans:p})=>{const u=(0,T.Cg)();let _;"initial_app_load"===s.navigationType&&(_=(0,o.Z)());const h=r.map((({name:t})=>t)),A=u.map((t=>(0,y.p)(t,h))).filter((({timing:t})=>!(({startTime:t,responseEnd:n},e)=>t>e.endTime||!!n&&n<e.startTime||t<e.startTime-100)(t,{startTime:d,endTime:i})));return{type:"COMPLETE",traceId:m,startTime:d,endTime:i,spans:g(A,m).concat(p),annotationMap:l({constraintMap:a,initialNavTiming:_,annotations:n}),binaryAnnotationMap:(0,f.rA)({annotateExperiments:t,binaryAnnotations:e,entries:u,metricId:s,performanceResources:A,pwtEndTime:i,pwtStaticContext:c})}};let h=!1;const A=(t,n)=>t&&n?h?((0,r.H)("duplicated_initial_app_load_surface_pwt"),(0,m.Z)()):(h=!0,n):(0,m.Z)();var I=e(883119),S=e(226464),v=e(785893);function x({children:t,heading:n}){return(0,v.jsxs)("table",{style:{width:"100%"},cellPadding:4,children:[(0,v.jsx)("thead",{children:(0,v.jsx)("tr",{children:(0,v.jsx)("th",{colSpan:2,style:{background:"#efefef"},children:(0,v.jsx)(I.xv,{weight:"bold",align:"center",children:n})})})}),(0,v.jsx)("tbody",{children:t})]})}function E({name:t,children:n}){return(0,v.jsxs)("tr",{children:[(0,v.jsx)("td",{children:(0,v.jsx)(I.xv,{weight:"bold",children:t})}),(0,v.jsx)("td",{children:"string"==typeof n?(0,v.jsx)(I.xv,{children:n}):n})]})}function N({result:t}){return"ABORT"===t.type?(0,v.jsx)(E,{name:"Abort Reason",children:t.reason}):(0,v.jsxs)(a.Fragment,{children:[(0,v.jsx)(E,{name:"PWT (ms)",children:(0,v.jsx)(I.xv,{align:"end",children:Math.round(t.endTime-t.startTime)})}),(0,v.jsx)(E,{name:"PinTrace",children:(0,v.jsx)(I.xv,{italic:!0,children:(0,v.jsx)(I.rU,{href:`https://pintrace.pinadmin.com/zipkin/traces/${t.traceId.toString(16)}`,target:"blank",inline:!0,onClick:({dangerouslyDisableOnNavigation:t})=>t(),underline:"hover",children:"Open in a new tab"})})})]})}function C({data:t}){const{metricId:n,constraints:e,constraintMap:a,startTime:i,result:r}=t;return(0,v.jsxs)(I.xu,{children:[(0,v.jsxs)(x,{heading:(0,S.KJ)(n),children:[(0,v.jsx)(E,{name:"Thrift Id",children:String((0,S.Rp)(n))}),(0,v.jsx)(E,{name:"Surface",children:n.surface}),(0,v.jsx)(E,{name:"Navigation Type",children:n.navigationType}),(0,v.jsx)(E,{name:"Viewer Authed",children:String(n.isAuthenticated)})]}),(0,v.jsx)(x,{heading:"Constraints",children:e.map((t=>(0,v.jsx)(E,{name:t,children:(0,v.jsx)(I.xv,{align:"end",children:a[t]?Math.round(a[t]-i):"pending..."})},`constraint_${t}`)))}),(0,v.jsx)(x,{heading:"Result",children:r?(0,v.jsx)(N,{result:r}):(0,v.jsx)(E,{name:"result",children:(0,v.jsx)(I.$j,{accessibilityLabel:"profiling PWT",show:!0})})})]})}var w=e(223815);const M=t=>t.result?"COMPLETE"===t.result.type?"darkGray":"red":"gray";function b({data:t}){const[n,e]=(0,a.useState)(!1);return(0,v.jsx)(w.Z,{children:(0,v.jsxs)(I.mh,{children:[(0,v.jsx)(I.xu,{position:"fixed",margin:3,marginBottom:12,bottom:!0,left:!0,width:50,height:50,dangerouslySetInlineStyle:{__style:{zIndex:2e3}},children:(0,v.jsx)(I.hU,{accessibilityLabel:"PwtDebugger",bgColor:"lightGray",iconColor:M(t),icon:"flash",size:"lg",onClick:()=>e(!0)})}),n&&(0,v.jsx)(I.xu,{position:"absolute",dangerouslySetInlineStyle:{__style:{zIndex:2e3}},children:(0,v.jsx)(I.u_,{accessibilityModalLabel:"Pinner Wait Time Debugger Details",heading:"Pinner Wait Time",onDismiss:()=>e(!1),footer:null,size:"sm",children:(0,v.jsx)(I.xu,{padding:6,children:(0,v.jsx)(C,{data:t})})})})]})})}var j=e(558775);const O=(t,n)=>{const e=(0,a.useRef)(t);(0,a.useEffect)((()=>{e.current=t}),[t]);const i=(0,a.useRef)(n);(0,a.useEffect)((()=>{i.current=n}),[n]),(0,a.useEffect)((()=>()=>i.current(e.current)),[])},R=(t,n)=>{const[e,i]=(0,a.useState)(n);return{state:e,dispatch:n=>i((e=>t(e,n)))}};var L=e(985271),D=e(7789),Z=e(383434),B=e(567450),P=e(276602),z=e(404646);const $=["initial_app_load","client_route_push"],U=(0,Z.X)("PwtSurface"),G="NavigationComplete",k="VisuallyComplete",H=(t,n)=>{t.isSampled&&(0,j.Z)({metricId:t.metricConfig.metricId,pwtStaticContext:t.metricConfig.pwtStaticContext,result:{type:"ABORT",reason:n}})},K=t=>{if(t.metricConfig.constraints.every((n=>t.constraintMap[n]))){const n=Math.max(...t.metricConfig.constraints.map((n=>t.constraintMap[n])));return((t,n)=>{var e;const{metricConfig:{metricId:a,pwtStaticContext:i,annotateExperiments:o},annotations:c,binaryAnnotations:d,constraintMap:l,startTime:m,imageTimings:p,isSampled:u,spans:g}=t,T=A("initial_app_load"===a.navigationType,null===(e=i.serverData)||void 0===e?void 0:e.trace_id),y=_({annotateExperiments:o,annotations:c,binaryAnnotations:d,constraintMap:l,endTime:n,imageTimings:p,metricId:a,pwtStaticContext:i,startTime:m,traceId:T,spans:g});u&&(0,j.Z)({metricId:a,pwtStaticContext:i,result:y});try{s(String(y.binaryAnnotationMap["metricId.surface"].value))}catch(f){(0,r.H)("image_ratio_check_error",{error:f})}return{...t,result:y,status:"DONE"}})(t,n)}return t},V=(t,n)=>{const{constraint:e,time:a}=n,i=(0,S.KJ)(t.metricConfig.metricId);return L.Z?t.metricConfig.constraints.find((t=>t===e))?t.constraintMap[e]?(U(`constraint "${e}" is already complete.`),(0,r.H)("duplicated_constraint_complete",{constraint:e,action:i}),t):(U(`marking constraint "${e}" as complete`),(0,c.ZP)(`constraint_${e}_is_complete`),K({...t,constraintMap:{...t.constraintMap,[e]:a||L.Z.now()}})):(U(`marked constraint "${e}" is not a required constraint.`),t):((0,r.H)("missing_window_performance",{action:i}),t)},J=(t,n)=>{if(U("dispatch action",n),"INIT_ROUTE"===n.type)return((t,n)=>{const{metricConfig:e,startTime:a,isSampled:i}=n;if("TIMING"===t.status&&a!==t.startTime&&H(t,"routeUpdatedOnSameSurface"),!e)return{status:"DISABLED",metricConfig:null};const s=(0,S.KJ)(e.metricId);return"TIMING"===t.status&&t.startTime===a&&t.constraintMap.NavigationComplete?((0,r.H)("duplicated_init_route_action",{action:s}),t):("Other"===e.pwtStaticContext.browserName&&!1===e.metricId.isAuthenticated&&"initial_app_load"===e.metricId.navigationType?((0,r.A9)(`TIMING.${s}`,{tags:{userAgent:null===(o=window)||void 0===o||null===(c=o.navigator)||void 0===c?void 0:c.userAgent}}),(0,r.A9)(`TIMING.sampled.${s}`,{tags:{userAgent:null===(d=window)||void 0===d||null===(l=d.navigator)||void 0===l?void 0:l.userAgent},sampleRate:.5})):((0,r.A9)(`TIMING.${s}`),(0,r.A9)(`TIMING.sampled.${s}`,{sampleRate:.5})),V({status:"TIMING",metricConfig:e,startTime:a,constraintMap:{},annotations:{},binaryAnnotations:{},imageTimings:[],isSampled:i,spans:[]},{constraint:G}));var o,c,d,l})(t,n.payload);if("TIMING"!==t.status)return U(`ignoring action due to invalid state ${t.status}`,n),t;switch(n.type){case"ABORT":H(t,n.reason);const e={type:"ABORT",reason:n.reason};return{...t,status:"DONE",result:e};case"ANNOTATE":const{name:a}=n.payload;if(!L.Z)return t;const i=L.Z.now();return U(`adding annotation {${a}: ${i}}`),{...t,annotations:{...t.annotations,[a]:i}};case"BINARY_ANNOTATE":const{name:s,value:o,annotationType:c}=n.payload;return U(`adding binary annotation {${s}: ${o}}`),{...t,binaryAnnotations:{...t.binaryAnnotations,[s]:{value:o,type:c}}};case"MARK_CONSTRAINT_COMPLETE":return V(t,n.payload);case"REMOVE_CONSTRAINT":return((t,n)=>{if(!L.Z){const n=(0,S.KJ)(t.metricConfig.metricId);(0,r.H)("missing_window_performance",{action:n})}U(`removing constraint "${n}"`);const e=t.metricConfig.constraints.filter((t=>t!==n)),{[n]:a,...i}=t.constraintMap;return K({...t,constraintMap:i,metricConfig:{...t.metricConfig,constraints:e}})})(t,n.payload);case"SET_SEGMENT":return((t,n)=>{if(!L.Z){const n=(0,S.KJ)(t.metricConfig.metricId);(0,r.H)("missing_window_performance",{action:n})}U(`updating pwt segment to "${n}"`);const e={...t.metricConfig.metricId,segment:n};return{...t,metricConfig:{...t.metricConfig,metricId:e}}})(t,n.payload);case"SET_VISUALLY_COMPLETE_RESULT":{const{payload:{imageTimings:e}}=n;if(0===e.length){H(t,"visuallyComplete_noImages");const n={type:"ABORT",reason:"visuallyComplete_noImages"};return{...t,status:"DONE",result:n}}const a=Math.max(...e.map((t=>t.responseEnd||0)));return V({...t,imageTimings:e},{constraint:k,time:a})}case"ADD_SUBSPAN":const{startTime:d}=t,{payload:{name:l,startTime:p,endTime:u,annotations:g,binaryAnnotations:T,parentId:y}}=n;return{...t,spans:[...t.spans,{name:l,id:(0,m.Z)(),startTime:p||d,endTime:u,annotationMap:{...g},binaryAnnotationMap:{...T},parentId:y}]};case"START_SUBSPAN":return{...t,spans:[...t.spans,{name:n.payload.name,id:(0,m.Z)(),startTime:L.Z?L.Z.now():0,endTime:1/0,annotationMap:{...n.payload.annotations},binaryAnnotationMap:{...n.payload.binaryAnnotations},parentId:n.payload.parentId}]};case"STOP_SUBSPAN":const f=t.spans.findIndex((t=>t.name===n.payload.name));return f>-1?(t.spans[f].endTime=L.Z?L.Z.now():0,n.payload.annotations&&(t.spans[f].annotationMap={...t.spans[f].annotationMap,...n.payload.annotations}),n.payload.binaryAnnotations&&(t.spans[f].binaryAnnotationMap={...t.spans[f].binaryAnnotationMap,...n.payload.binaryAnnotations})):(0,r.H)("invalid_subspan_stop_name",{name:n.payload.name}),t;default:const _=(0,S.KJ)(t.metricConfig.metricId);return(0,r.H)("invalid_pwt_surface_action",{action:_}),t}};function W({children:t,...n}){var e;const i=(0,z.fM)(),s=(t=>{if(!t)return"initial_app_load";switch(t.action){case"PUSH":return"client_route_push";case"REPLACE":return"client_route_replace";default:return null}})(i),o=["seo_web_react18_render","web_react18_render_auth","web_react18_render_unauth",...null!==(e=n.annotateExperiments)&&void 0!==e?e:[]],c={...n,annotateExperiments:o,navigationInfo:{navigationType:s,clientNavigation:i}},{state:d,context:l}=(({surface:t,constraints:n,segment:e,measureGridVisuallyComplete:i,annotateExperiments:r,customEnabledNavigationTypes:s,navigationInfo:{clientNavigation:o,navigationType:c},sampleRate:d})=>{const l=(0,a.useRef)("NOT_SET"),m=(0,z.N5)(),{state:p,dispatch:u}=R(J,{status:"DISABLED",metricConfig:null});if(l.current!==o&&(l.current=o,m)){const{isAuthenticated:a}=m,l=s||$,p=t&&c&&l.includes(c)?{metricId:{type:"surface",surface:t,navigationType:c,isAuthenticated:a,segment:e},annotateExperiments:r,constraints:[G,...n||[],...i?[k]:[]],pwtStaticContext:m}:null;u({type:"INIT_ROUTE",payload:{metricConfig:p,startTime:o?o.time:0,isSampled:!d||Math.random()<d}})}if((0,a.useEffect)((()=>{const t=t=>{u({type:"ABORT",reason:t})};B.Z.onSessionPause(t);const n=()=>{window.removeEventListener("resize",n),u({type:"ABORT",reason:"windowResized"})};return window.addEventListener("resize",n),()=>{B.Z.removePauseListener(t),window.removeEventListener("resize",n)}}),[]),O(p,(t=>{U("handling unmount",t),"TIMING"===t.status&&H(t,"unmount")})),"TIMING"!==p.status||!p.constraintMap.NavigationComplete)return{state:p,context:null};const{startTime:g,metricConfig:T}=p;return{state:p,context:{id:g,metricId:T.metricId,abort:t=>u({type:"ABORT",reason:t}),addAnnotation:t=>u({type:"ANNOTATE",payload:{name:t}}),addBinaryAnnotation:(t,n,e)=>u({type:"BINARY_ANNOTATE",payload:{name:t,value:n,annotationType:e}}),setVisuallyCompleteResult:T.constraints.includes(k)?t=>u({type:"SET_VISUALLY_COMPLETE_RESULT",payload:t}):null,markConstraintComplete:t=>u({type:"MARK_CONSTRAINT_COMPLETE",payload:{constraint:t,time:L.Z?L.Z.now():0}}),removeConstraint:t=>u({type:"REMOVE_CONSTRAINT",payload:t}),setSegment:t=>u({type:"SET_SEGMENT",payload:t}),addSubspan:(t,n,e,a={},i={},r=null)=>u({type:"ADD_SUBSPAN",payload:{name:t,startTime:n,endTime:e,annotations:a,binaryAnnotations:i,parentId:r}}),startSubspan:(t,n={},e={},a=null)=>u({type:"START_SUBSPAN",payload:{name:t,annotations:n,binaryAnnotations:e,parentId:a}}),stopSubspan:(t,n={},e={},a=null)=>u({type:"STOP_SUBSPAN",payload:{name:t,annotations:n,binaryAnnotations:e,parentId:a}})}}})(c);return(()=>{const t=(0,P.EV)(),n=!!t;(0,a.useEffect)((()=>{if(n){const n=null!=t&&t.metricId?(0,S.KJ)(t.metricId):null;(0,r.H)("nested_pwt_surface",{action:n})}}),[n])})(),(0,v.jsxs)(a.Fragment,{children:[(0,v.jsx)(P.Sb,{value:l,children:t}),D.DQ&&"DISABLED"!==d.status&&(0,v.jsx)(b,{data:{metricId:d.metricConfig.metricId,constraints:d.metricConfig.constraints,constraintMap:d.constraintMap,startTime:d.startTime,result:"DONE"===d.status?d.result:null}})]})}},528961:(t,n,e)=>{e.d(n,{cC:()=>r,jy:()=>i,qr:()=>o,sk:()=>s});const a=t=>"number"==typeof t?Math.round(t):t,i=t=>({type:"I16",value:a(t)}),r=t=>({type:"I32",value:a(t)}),s=t=>({type:"STRING",value:t}),o=t=>({type:"BOOL",value:t})}}]);
//# sourceMappingURL=https://sm.pinimg.com/webapp/35957-4d61e9870265982a.mjs.map